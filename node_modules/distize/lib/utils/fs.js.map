{"version":3,"sources":["../../src/utils/fs.ts"],"sourcesContent":["import {\n  lstat,\n  mkdir,\n  readdir,\n  readFile,\n  rmdir,\n  Stats,\n  unlink,\n  writeFile,\n} from 'fs'\nimport { dirname, join } from 'path'\n\nfunction lstatPromise(path: string): Promise<Stats> {\n  return new Promise((resolve, reject) => {\n    lstat(path, (err, stat) => {\n      if (err) {\n        return reject(err)\n      }\n      return resolve(stat)\n    })\n  })\n}\n\nfunction mkdirRecursivePromise(path: string): Promise<void> {\n  return new Promise((resolve, reject) => {\n    mkdir(path, { recursive: true }, (err) => {\n      if (err) {\n        return reject(err)\n      }\n      return resolve()\n    })\n  })\n}\n\nfunction readdirPromise(path: string): Promise<string[]> {\n  return new Promise((resolve, reject) => {\n    readdir(path, (err, files) => {\n      if (err) {\n        return reject(err)\n      }\n      return resolve(files)\n    })\n  })\n}\n\nfunction readFilePromise(path: string): Promise<Buffer> {\n  return new Promise((resolve, reject) => {\n    readFile(path, (err, data) => {\n      if (err) {\n        return reject(err)\n      }\n      return resolve(data)\n    })\n  })\n}\n\nfunction writeFilePromise(path: string, data: any): Promise<void> {\n  return new Promise((resolve, reject) => {\n    writeFile(path, data, (err) => {\n      if (err) {\n        return reject(err)\n      }\n      return resolve()\n    })\n  })\n}\n\nfunction rmdirPromise(path: string): Promise<void> {\n  return new Promise((resolve, reject) => {\n    rmdir(path, (err) => {\n      if (err) {\n        if (err.code === 'ENOTEMPTY') {\n          return resolve()\n        }\n        return reject(err)\n      }\n      return resolve()\n    })\n  })\n}\n\nfunction unlinkPromise(path: string): Promise<void> {\n  return new Promise((resolve, reject) => {\n    unlink(path, (err) => {\n      if (err) {\n        return reject(err)\n      }\n      return resolve()\n    })\n  })\n}\n\nexport function remove(path: string): Promise<void> {\n  return lstatPromise(path)\n    .then((status) => {\n      if (status.isDirectory()) {\n        return readdirPromise(path)\n          .then((files) =>\n            files.reduce((carry, file) => {\n              return carry.then(() => remove(join(path, file)))\n            }, Promise.resolve())\n          )\n          .then(() => rmdirPromise(path))\n      }\n      return unlinkPromise(path)\n    })\n    .catch((e) => {\n      if (e.code === 'ENOENT') {\n        return\n      }\n      return console.error(e)\n    })\n}\n\nexport interface CopyOptions {\n  onCopy?: (src: string, dest: string) => any\n}\n\nexport function copy(\n  src: string,\n  dest: string,\n  options: CopyOptions = {}\n): Promise<void> {\n  return lstatPromise(src).then((srcStat) => {\n    // src is directory\n    if (srcStat.isDirectory()) {\n      return readdirPromise(src).then((files) =>\n        files.reduce((carry, file) => {\n          return carry.then(() =>\n            copy(join(src, file), join(dest, file), options)\n          )\n        }, Promise.resolve())\n      )\n    }\n\n    const destDir = dirname(dest)\n\n    return lstatPromise(dest)\n      .then(() => remove(dest))\n      .catch((e) => {\n        if (e.code === 'ENOENT') {\n          return\n        }\n        return console.error(e)\n      })\n      .then(() => lstatPromise(destDir))\n      .catch((e) => {\n        if (e.code === 'ENOENT') {\n          return mkdirRecursivePromise(destDir)\n        }\n        return console.error(e)\n      })\n      .then(() => readFilePromise(src))\n      .then((body) =>\n        writeFilePromise(dest, body).then(() => options.onCopy?.(src, dest))\n      )\n  })\n}\n"],"names":["remove","copy","lstatPromise","path","Promise","resolve","reject","lstat","err","stat","mkdirRecursivePromise","mkdir","recursive","readdirPromise","readdir","files","readFilePromise","readFile","data","writeFilePromise","writeFile","rmdirPromise","rmdir","code","unlinkPromise","unlink","then","status","isDirectory","reduce","carry","file","join","catch","e","console","error","src","dest","options","srcStat","destDir","dirname","body","onCopy"],"mappings":"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"}
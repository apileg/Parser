{"version":3,"sources":["../../src/utils/npm.ts"],"sourcesContent":["import { exec } from 'child_process'\n\nconst RE_NODE_MODULES = /[/\\\\]node_modules[/\\\\]/g\n\nexport interface ListPackagesOptions {\n  cwd?: string\n  devDeps?: boolean\n  noDeps?: boolean\n}\n\nexport function listPackagePaths(\n  options: ListPackagesOptions = {}\n): Promise<string[]> {\n  let command = 'npm ls --prod=true --parseable=true --all'\n  if (options.devDeps && options.noDeps) {\n    command = 'npm ls --dev=true --parseable=true --all'\n  } else if (options.devDeps) {\n    command = 'npm ls --parseable=true --all'\n  } else if (options.noDeps) {\n    return Promise.resolve([])\n  }\n\n  return new Promise((resolve, reject) => {\n    exec(command, { cwd: options.cwd }, (err, stdout) => {\n      if (err) {\n        return reject(err)\n      }\n      const packages = stdout\n        .toString()\n        .split('\\n')\n        .filter((line) => {\n          const matches = line.match(RE_NODE_MODULES)\n          return matches && matches.length === 1\n        })\n      resolve(packages)\n    })\n  })\n}\n"],"names":["listPackagePaths","RE_NODE_MODULES","options","command","devDeps","noDeps","Promise","resolve","reject","exec","cwd","err","stdout","packages","toString","split","filter","line","matches","match","length"],"mappings":"AAAA;;;;QAUgBA,gBAAgB,GAAhBA,gBAAgB;AAVX,IAAA,aAAe,WAAf,eAAe,CAAA;AAEpC,IAAMC,eAAe,4BAA4B;AAQ1C,SAASD,gBAAgB,GAEX;QADnBE,OAA4B,GAA5BA,+CAAiC,kBAAF,EAAE;IAEjC,IAAIC,OAAO,GAAG,2CAA2C;IACzD,IAAID,OAAO,CAACE,OAAO,IAAIF,OAAO,CAACG,MAAM,EAAE;QACrCF,OAAO,GAAG,0CAA0C;KACrD,MAAM,IAAID,OAAO,CAACE,OAAO,EAAE;QAC1BD,OAAO,GAAG,+BAA+B;KAC1C,MAAM,IAAID,OAAO,CAACG,MAAM,EAAE;QACzB,OAAOC,OAAO,CAACC,OAAO,CAAC,EAAE,CAAC,CAAA;KAC3B;IAED,OAAO,IAAID,OAAO,CAAC,SAACC,OAAO,EAAEC,MAAM,EAAK;QACtCC,CAAAA,GAAAA,aAAI,AAYF,CAAA,MAZGN,OAAO,EAAE;YAAEO,GAAG,EAAER,OAAO,CAACQ,GAAG;SAAE,EAAE,SAACC,GAAG,EAAEC,MAAM,EAAK;YACnD,IAAID,GAAG,EAAE;gBACP,OAAOH,MAAM,CAACG,GAAG,CAAC,CAAA;aACnB;YACD,IAAME,QAAQ,GAAGD,MAAM,CACpBE,QAAQ,EAAE,CACVC,KAAK,CAAC,IAAI,CAAC,CACXC,MAAM,CAAC,SAACC,IAAI,EAAK;gBAChB,IAAMC,OAAO,GAAGD,IAAI,CAACE,KAAK,CAAClB,eAAe,CAAC;gBAC3C,OAAOiB,OAAO,IAAIA,OAAO,CAACE,MAAM,KAAK,CAAC,CAAA;aACvC,CAAC;YACJb,OAAO,CAACM,QAAQ,CAAC;SAClB,CAAC;KACH,CAAC,CAAA;CACH"}